#   
# This is the Apache server configuration file providing SSL support.
# It contains the configuration directives to instruct the server how to
# serve pages over an https connection. For detailing information about these
# directives see <URL:http://httpd.apache.org/docs/2.2/mod/mod_ssl.html>
#   
# Do NOT simply read the instructions in here without understanding
# what they do.  They're here only as hints or reminders.  If you are unsure
# consult the online docs. You have been warned.  
#   

LoadModule ssl_module modules/mod_ssl.so

#   
# When we also provide SSL we have to listen to the
# the HTTPS port in addition.
#
Listen 443

##
##  SSL Global Context
##
##  All SSL configuration in this context applies both to
##  the main server and all SSL-enabled virtual hosts.
##

# 
#   Some MIME-types for downloading Certificates and CRLs
#
AddType application/x-x509-ca-cert .crt
AddType application/x-pkcs7-crl    .crl

#   Pass Phrase Dialog:
#   Configure the pass phrase gathering process.
#   The filtering dialog program (`builtin' is a internal
#   terminal dialog) has to provide the pass phrase on stdout.
SSLPassPhraseDialog  exec:/etc/httpd/phrase

#   Inter-Process Session Cache:
#   Configure the SSL Session Cache: First the mechanism 
#   to use and second the expiring timeout (in seconds).
#SSLSessionCache        dc:UNIX:/var/cache/mod_ssl/distcache
SSLSessionCache         shmcb:/var/cache/mod_ssl/scache(512000)
SSLSessionCacheTimeout  300

#   Semaphore:
#   Configure the path to the mutual exclusion semaphore the
#   SSL engine uses internally for inter-process synchronization.
SSLMutex default

#   Pseudo Random Number Generator (PRNG):
#   Configure one or more sources to seed the PRNG of the
#   SSL library. The seed data should be of good random quality.
#   WARNING! On some platforms /dev/random blocks if not enough entropy
#   is available. This means you then cannot use the /dev/random device
#   because it would lead to very long connection times (as long as
#   it requires to make more entropy available). But usually those
#   platforms additionally provide a /dev/urandom device which doesn't
#   block. So, if available, use this one instead. Read the mod_ssl User
#   Manual for more details.
SSLRandomSeed startup file:/dev/urandom  256
SSLRandomSeed connect builtin
#SSLRandomSeed startup file:/dev/random  512
#SSLRandomSeed connect file:/dev/random  512
#SSLRandomSeed connect file:/dev/urandom 512

#
# Use "SSLCryptoDevice" to enable any supported hardware
# accelerators. Use "openssl engine -v" to list supported
# engine names.  NOTE: If you enable an accelerator and the
# server does not start, consult the error logs and ensure
# your accelerator is functioning properly.
#
SSLCryptoDevice builtin
#SSLCryptoDevice ubsec

##
## SSL Virtual Host Context
##

<VirtualHost _default_:443>

# General setup for the virtual host, inherited from global configuration
##DocumentRoot "/opt/kaltura/app/alpha/web"
ServerName www.kaltura.com:443

# Use separate log files for the SSL virtual host; note that LogLevel
# is not inherited from httpd.conf.
ErrorLog logs/ssl_error_log
#TransferLog logs/ssl_www.kaltura.com_access_log
LogLevel warn
#   SSL Engine Switch:
#   Enable/Disable SSL for this virtual host.
SSLEngine on

#   SSL Protocol support: 
# List the enable protocol levels with which clients will be able to
# connect.  Disable SSLv2 access by default: 
SSLProtocol all -SSLv2

#   SSL Cipher Suite:
# List the ciphers that the client is permitted to negotiate.
# See the mod_ssl documentation for a complete list.
SSLCipherSuite ALL:!ADH:!EXPORT:!SSLv2:RC4+RSA:+HIGH:+MEDIUM:+LOW

#   Server Certificate:
# Point SSLCertificateFile at a PEM encoded certificate.  If
# the certificate is encrypted, then you will be prompted for a
# pass phrase.  Note that a kill -HUP will prompt again.  A new
# certificate can be generated using the genkey(1) command.
SSLCertificateFile /etc/httpd/wildcard.kaltura.com.crt

#   Server Private Key:
#   If the key is not combined with the certificate, use this
#   directive to point at the key file.  Keep in mind that if
#   you've both a RSA and a DSA private key you can configure
#   both in parallel (to also allow the use of DSA ciphers, etc.)
SSLCertificateKeyFile /etc/httpd/wildcard.kaltura.com.key

#   Server Certificate Chain:
#   Point SSLCertificateChainFile at a file containing the
#   concatenation of PEM encoded CA certificates which form the
#   certificate chain for the server certificate. Alternatively
#   the referenced file can be the same as SSLCertificateFile
#   when the CA certificates are directly appended to the server
#   certificate for convinience.
SSLCertificateChainFile /etc/httpd/gd_bundle.crt

#   Certificate Authority (CA):
#   Set the CA certificate verification path where to find CA
#   certificates for client authentication or alternatively one
#   huge file containing all of them (file must be PEM encoded)
#SSLCACertificateFile /etc/pki/tls/certs/ca-bundle.crt

#   Client Authentication (Type):
#   Client certificate verification type and depth.  Types are
#   none, optional, require and optional_no_ca.  Depth is a
#   number which specifies how deeply to verify the certificate
#   issuer chain before deciding the certificate is not valid.
#SSLVerifyClient require
#SSLVerifyDepth  10

#   Access Control:
#   With SSLRequire you can do per-directory access control based
#   on arbitrary complex boolean expressions containing server
#   variable checks and other lookup directives.  The syntax is a
#   mixture between C and Perl.  See the mod_ssl documentation
#   for more details.
#<Location />
#SSLRequire (    %{SSL_CIPHER} !~ m/^(EXP|NULL)/ \
#            and %{SSL_CLIENT_S_DN_O} eq "Snake Oil, Ltd." \
#            and %{SSL_CLIENT_S_DN_OU} in {"Staff", "CA", "Dev"} \
#            and %{TIME_WDAY} >= 1 and %{TIME_WDAY} <= 5 \
#            and %{TIME_HOUR} >= 8 and %{TIME_HOUR} <= 20       ) \
#           or %{REMOTE_ADDR} =~ m/^192\.76\.162\.[0-9]+$/
#</Location>

#   SSL Engine Options:
#   Set various options for the SSL engine.
#   o FakeBasicAuth:
#     Translate the client X.509 into a Basic Authorisation.  This means that
#     the standard Auth/DBMAuth methods can be used for access control.  The
#     user name is the `one line' version of the client's X.509 certificate.
#     Note that no password is obtained from the user. Every entry in the user
#     file needs this password: `xxj31ZMTZzkVA'.
#   o ExportCertData:
#     This exports two additional environment variables: SSL_CLIENT_CERT and
#     SSL_SERVER_CERT. These contain the PEM-encoded certificates of the
#     server (always existing) and the client (only existing when client
#     authentication is used). This can be used to import the certificates
#     into CGI scripts.
#   o StdEnvVars:
#     This exports the standard SSL/TLS related `SSL_*' environment variables.
#     Per default this exportation is switched off for performance reasons,
#     because the extraction step is an expensive operation and is usually
#     useless for serving static content. So one usually enables the
#     exportation for CGI and SSI requests only.
#   o StrictRequire:
#     This denies access when "SSLRequireSSL" or "SSLRequire" applied even
#     under a "Satisfy any" situation, i.e. when it applies access is denied
#     and no other module can change it.
#   o OptRenegotiate:
#     This enables optimized SSL connection renegotiation handling when SSL
#     directives are used in per-directory context. 
#SSLOptions +FakeBasicAuth +ExportCertData +StrictRequire
<Files ~ "\.(cgi|shtml|phtml|php3?)$">
    SSLOptions +StdEnvVars
</Files>
<Directory "/var/www/cgi-bin">
    SSLOptions +StdEnvVars
</Directory>

#   SSL Protocol Adjustments:
#   The safe and default but still SSL/TLS standard compliant shutdown
#   approach is that mod_ssl sends the close notify alert but doesn't wait for
#   the close notify alert from client. When you need a different shutdown
#   approach you can use one of the following variables:
#   o ssl-unclean-shutdown:
#     This forces an unclean shutdown when the connection is closed, i.e. no
#     SSL close notify alert is send or allowed to received.  This violates
#     the SSL/TLS standard but is needed for some brain-dead browsers. Use
#     this when you receive I/O errors because of the standard approach where
#     mod_ssl sends the close notify alert.
#   o ssl-accurate-shutdown:
#     This forces an accurate shutdown when the connection is closed, i.e. a
#     SSL close notify alert is send and mod_ssl waits for the close notify
#     alert of the client. This is 100% SSL/TLS standard compliant, but in
#     practice often causes hanging connections with brain-dead browsers. Use
#     this only for browsers where you know that their SSL implementation
#     works correctly. 
#   Notice: Most problems of broken clients are also related to the HTTP
#   keep-alive facility, so you usually additionally want to disable
#   keep-alive for those clients, too. Use variable "nokeepalive" for this.
#   Similarly, one has to force some clients to use HTTP/1.0 to workaround
#   their broken HTTP/1.1 implementation. Use variables "downgrade-1.0" and
#   "force-response-1.0" for this.
SetEnvIf User-Agent ".*MSIE.*" \
         nokeepalive ssl-unclean-shutdown \
         downgrade-1.0 force-response-1.0

#   Per-Server Logging:
#   The home of a custom SSL log file. Use this when you want a
#   compact non-error SSL logfile on a virtual host basis.
#CustomLog logs/ssl_request_log \
#          "%t %h %{SSL_PROTOCOL}x %{SSL_CIPHER}x \"%r\" %b"
CustomLog logs/ssl_access_log \
           "%h %l %u %t \"%r\" %>s %b %T/%D \"%{Referer}i\" \"%{User-Agent}i\" \"%{uv}C\" %a \"%{X-Kaltura}o\" \"%{HOST}i\" %P %{KalturaLog_UniqueId}n %X %I %{SSL_PROTOCOL}x %{SSL_CIPHER}x"

ProxyTimeout 30
DocumentRoot "/opt/kaltura/app/alpha/web"
DirectoryIndex index.html

DeflateFilterNote Ratio ratio
DeflateCompressionLevel 9
FilterDeclare COMPRESS
FilterProvider COMPRESS DEFLATE resp=Content-Encoding !$gzip
FilterProvider COMPRESS DEFLATE resp=Content-Type $text
FilterProvider COMPRESS DEFLATE resp=Content-Type $application/x-javascript
FilterProvider COMPRESS DEFLATE resp=Content-Type $application/.*xml.*
FilterProvider COMPRESS DEFLATE resp=Content-Type $image/svg+xml
FilterChain COMPRESS

<IfModule mod_rewrite.c>
        RewriteEngine on
	RewriteCond %{HTTP_HOST} ^cdnakmi.kaltura.com$ [NC]
        RewriteRule ^/p/27121/sp/2712100/flvclipper.* /alive.html [L]
        RewriteCond   %{DOCUMENT_ROOT}%{REQUEST_FILENAME}  !-d
        RewriteCond   %{DOCUMENT_ROOT}%{REQUEST_FILENAME}  !-f
        RewriteRule ^/([a-zA-Z0-9]+[^/])$                /index.php/$1    [PT]
	RewriteMap servers rnd:/etc/httpd/conf/proxy.map
</IfModule>
<IfModule mod_rewrite.c>
RewriteEngine On
RewriteCond %{HTTP_HOST} ^kaltura.com$ [NC]
RewriteRule ^(.*)$ https://www.kaltura.com$1 [R,L]
</IfModule>
Alias /sf "/usr/share/pear/data/symfony/web/sf/"
<Directory "/opt/kaltura/app/alpha/web">
# set caching for static files such as crossdomain.xml
<FilesMatch "\.(xml|flv|ico|pdf|avi|mov|ppt|doc|mp3|wmv|wav)$">
ExpiresActive On
ExpiresDefault "access plus 3 month"
Header append Cache-Control "public"
SetEnv force-no-vary
Header unset ETag
FileETag None
</FilesMatch>

# IE8 download compatiblity
Header set X-UA-Compatible "IE=EmulateIE7"
DirectoryIndex index.php
RedirectMatch permanent ^/index.php/searchmusicians$ /index.php/search?mode=KSHOW\&keywords=music+bands+song+fan+scrapbook\&category=2\&or=t\&promotion=1
RedirectMatch permanent ^/index.php/index.php/(.+?)$ /index.php/$1
RedirectMatch permanent ^/index.php/index/s/UT/I/(.+?)$ /index.php?s=UT\&I=$1
RedirectMatch permanent ^/show/(.+?)/?$ /index.php/login/register?invite=1\&goto=/index.php\&s=UT\&I=$1
RedirectMatch permanent ^/show/?$ /index.php/login/register?invite=1\&goto=/index.php
RedirectMatch permanent ^/id/(.+?)/?$ /index.php/browse?kshow_id=$1
RewriteEngine on

# redirect kmc.kaltura.com to kaltura's kmc
RewriteCond %{HTTP_HOST} kmc.kaltura.com
RewriteRule .*  https://www.kaltura.com/index.php/kmc

# will redirect kaltura.com/kmc to www.kaltura.com/index.php/kmc
RewriteCond %{HTTP_HOST} ^kaltura.com$
RewriteRule .*  https://www.kaltura.com/index.php/kmc [L]

# redirect flash file with swfparams parameters to the bare flash file
RewriteRule ^(.*)/swfparams/(.*) /$1

RewriteRule ^p/[0-9]+/sp/[0-9]+/thumbnail/(.*)$ http://${servers:cache}/index.php/extwidget/thumbnail/$1 [P]
RewriteRule ^p/[0-9]+/thumbnail/(.*)$ http://${servers:cache}/index.php/extwidget/thumbnail/$1 [P]

RewriteRule ^p/[0-9]+/sp/[0-9]+/raw/(.*)$ /index.php/extwidget/raw/$1 [L]
RewriteRule ^p/[0-9]+/raw/(.*)$ /index.php/extwidget/raw/$1 [L]

RewriteRule ^p/[0-9]+/sp/[0-9]+/download/(.*)$ index.php/extwidget/download/$1 [L]
RewriteRule ^p/[0-9]+/download/(.*)$ index.php/extwidget/download/$1 [L]

RewriteRule ^index.php/downloadUrl(.*)$ /index.php/extwidget/downloadUrl/$1 [L]
RewriteRule ^downloadUrl(.*)$ /index.php/extwidget/downloadUrl/$1 [L]
RewriteRule ^entryPage(.*)$ /index.php/extwidget/entryPage/$1 [L]
RewriteRule ^userPage(.*)$ /index.php/extwidget/userPage/$1 [L]

RewriteRule ^p/[0-9]+/sp/[0-9]+/flvclipper/(.*)$ /index.php/keditorservices/flvclipper/$1 [L]
RewriteRule ^p/[0-9]+/flvclipper/(.*)$ /index.php/keditorservices/flvclipper/$1 [L]
RewriteRule ^flvclipper/(.*)$ /index.php/keditorservices/flvclipper/$1 [L]

RewriteRule ^s/p/[0-9]+/sp/[0-9]+/flvclipper/(.*)$ /index.php/keditorservices/flvclipper/$1 [L]
RewriteRule ^s/p/[0-9]+/flvclipper/(.*)$ /index.php/keditorservices/flvclipper/$1 [L]
RewriteRule ^s/flvclipper/(.*)$ /index.php/keditorservices/flvclipper/$1 [L]

RewriteRule ^p/[0-9]+/sp/[0-9]+/flv/(.*)$ /index.php/flv/$1 [L]
RewriteRule ^p/[0-9]+/flv/(.*)$ /index.php/flv/$1 [L]

RewriteRule ^p/[0-9]+/sp/[0-9]+/playManifest/(.*)$ /index.php/extwidget/playManifest/$1 [L]
RewriteRule ^p/[0-9]+/sp/[0-9]+/serveFlavor/(.*)$ /index.php/extwidget/serveFlavor/$1 [L]
RewriteRule ^p/[0-9]+/sp/[0-9]+/serveIsm/(.*)$ /index.php/extwidget/serveIsm/$1 [L]
RewriteRule ^p/[0-9]+/sp/[0-9]+/embedIframe/(.*)$ /index.php/extwidget/embedIframe/$1 [L]
RewriteRule ^p/[0-9]+/sp/[0-9]+/embedIframeJs/(.*)$ /index.php/extwidget/embedIframeJs/$1 [L]


RewriteRule ^s/p/[0-9]+/sp/[0-9]+/playManifest/(.*)$ /index.php/extwidget/playManifest/$1 [L]
RewriteRule ^s/p/[0-9]+/sp/[0-9]+/serveFlavor/(.*)$ /index.php/extwidget/serveFlavor/$1 [L]
RewriteRule ^s/p/[0-9]+/sp/[0-9]+/embedIframe/(.*)$ /index.php/extwidget/embedIframe/$1 [L]
RewriteRule ^s/p/[0-9]+/sp/[0-9]+/embedIframeJs/(.*)$ /index.php/extwidget/embedIframeJs/$1 [L]


RewriteRule ^p/[0-9]+/playManifest/(.*)$ /index.php/extwidget/playManifest/$1 [L]
RewriteRule ^p/[0-9]+/serveFlavor/(.*)$ /index.php/extwidget/serveFlavor/$1 [L]
RewriteRule ^p/[0-9]+/embedIframe/(.*)$ /index.php/extwidget/embedIframe/$1 [L]
RewriteRule ^p/[0-9]+/embedIframeJs/(.*)$ /index.php/extwidget/embedIframeJs/$1 [L]


RewriteRule ^s/p/[0-9]+/playManifest/(.*)$ /index.php/extwidget/playManifest/$1 [L]
RewriteRule ^s/p/[0-9]+/serveFlavor/(.*)$ /index.php/extwidget/serveFlavor/$1 [L]
RewriteRule ^s/p/[0-9]+/embedIframe/(.*)$ /index.php/extwidget/embedIframe/$1 [L]
RewriteRule ^s/p/[0-9]+/embedIframeJs/(.*)$ /index.php/extwidget/embedIframeJs/$1 [L]

RewriteRule ^p/[0-9]+/sp/[0-9]+/kpreloader/(.*)$ /index.php/extwidget/kpreloader/$1 [L]
RewriteRule ^p/[0-9]+/kpreloader/(.*)$ /index.php/extwidget/kpreloader/$1 [L]
RewriteRule ^kpreloader/(.*)$ /index.php/extwidget/kpreloader/$1 [L]

RewriteRule ^p/[0-9]+/sp/[0-9]+/swf/(.*)$ /swf/$1 [L]
RewriteRule ^p/[0-9]+/swf/(.*)$ /swf/$1 [L]

RewriteRule ^p/[0-9]+/sp/[0-9]+/demos/(.*)$ /demos/$1 [L]
RewriteRule ^p/[0-9]+/demos/(.*)$ /demos/$1 [L]

RewriteRule ^p/[0-9]+/sp/[0-9]+/flash/(.*)$ /flash/$1 [L]
RewriteRule ^p/[0-9]+/flash/(.*)$ /flash/$1 [L]

RewriteRule ^kwidget/(.*)$ /index.php/extwidget/kwidget/$1 [L]

RewriteRule ^kcw/(.*)$ /index.php/extwidget/kcw/$1 [L]
RewriteRule ^kse/(.*)$ /index.php/extwidget/kse/$1 [L]
RewriteRule ^kae/(.*)$ /index.php/extwidget/kae/$1 [L]
RewriteRule ^kupload/(.*)$ /index.php/extwidget/kupload/$1 [L]
RewriteRule ^krecord/(.*)$ /index.php/extwidget/krecord/$1 [L]
RewriteRule ^kgeneric/(.*)$ /index.php/extwidget/kgeneric/$1 [L]

RewriteRule ^api/(.*)$ /index.php/partnerservices2/$1 [L]

RewriteRule ^p/[0-9]+/content/(.*)$ /content/$1 [L]
RewriteRule ^p/[0-9]+/sp/[0-9]+/content/(.*)$ /content/$1 [L]

RewriteRule ^extservices/(.*)$ /index.php/extservices/$1 [L]

# redirect collectstats to alive.html
RewriteRule ^(.*)/collectstats /alive.html [L]

RewriteRule ^tracker$ /tracker.php [L]

# rewrite rule for an errornous url from myspace - fetch a 1-pixel.gif
RewriteRule ^(.*)entry/widget/(.*) /images/blank_one_pixel.gif [L]

# rewrite rules for old links
RewriteRule ^swf/(.*)$ OLD_PATHS/web/swf/$1 [L]
RewriteRule ^simpleswf/(.*)$ OLD_PATHS/web/simpleswf/$1 [L]
RewriteRule ^images/(.*)$ OLD_PATHS/web/images/$1 [L]
RewriteRule ^js/(.*)$ OLD_PATHS/web/js/$1 [L]
RewriteRule ^css/(.*)$ OLD_PATHS/web/css/$1 [L]
RewriteRule ^projects/(.*)$ OLD_PATHS/web/projects/$1 [L]
RewriteRule ^groupalbum(.*)$ OLD_PATHS/web/groupalbum/index.php [L]
RewriteRule ^fb_greetings(.*)$ OLD_PATHS/web/fb_greetings/index.php [L]
RewriteRule ^yedda/(.*)$ OLD_PATHS/web/yedda/$1 [L]
RewriteRule ^makeover(.*)$ OLD_PATHS/web/makeover/index.php [L]
RewriteRule ^sampleImplementation/(.*)$ OLD_PATHS/web/sampleImplementation/$1 [L]
RewriteRule ^survey$ http://www.surveymonkey.com/s.aspx?sm=h8ApKtLNiRQw51Jo_2fClOPA_3d_3d

RewriteCond %{QUERY_STRING}  service=stats&action=collect
RewriteRule api_v3/index.php /alive.html [L]

RedirectMatch permanent ^/tiny/([0-9a-z]{4})$ /api_v3/index.php?service=shortLink_shortLink\&action=goto\&id=$1

        Options FollowSymLinks ExecCGI Includes
        AllowOverride None
        Allow from all
</Directory>


############# OLD_PATHS #########################
Alias /OLD_PATHS "/opt/kaltura/OLD_PATHS"
<Directory "/opt/kaltura/OLD_PATHS">
	DirectoryIndex index.php
	ExpiresActive On
	ExpiresDefault "access plus 1 week"
	Header unset ETag
	FileETag None
	Header unset Vary
        AllowOverride None
        Allow from all
</Directory>

<Directory "/opt/kaltura/OLD_PATHS/web/projects/sony/chevelle">
    RewriteEngine on
    #Redirect 301 / http://projects.kaltura.com/sony/chevelle/index.php
    RewriteRule .* http://projects.kaltura.com/sony/chevelle/index.php [R=301,L]
    AllowOverride None
    Allow from all
</Directory>

<Directory "/opt/kaltura/OLD_PATHS/web/projects/metacafe/toystory">
    ExpiresActive Off
    AllowOverride None
    Allow from all
</Directory>

<Directory "/opt/kaltura/OLD_PATHS/web/blog">
    # redirect blog to corp.kaltura.com
    RewriteEngine on
    RewriteRule ^(.*)$ http://corp.kaltura.com/blog/$1 [R=301,NC]
    AllowOverride None
    Allow from all
</Directory>
<Directory "/opt/kaltura/OLD_PATHS/web/wiki">
    # redirect wiki to corp.kaltura.com
    RewriteEngine on
    RewriteRule ^(.*)$ http://corp.kaltura.com/wiki/$1 [R=301,NC]
    AllowOverride None
    Allow from all
</Directory>
<Directory "/opt/kaltura/OLD_PATHS/web/css">
    SetOutputFilter DEFLATE
    AllowOverride None
    Allow from all
</Directory>

##########################

Alias /content/uiconf "/opt/kaltura/content/uiconf"
<Directory "/opt/kaltura/content/uiconf">
        AddHandler cgi-script .php .pl .py .jsp .asp .htm .shtml .sh .cgi
        Options -ExecCGI
        SetEnv force-no-vary

        ExpiresActive On
        ExpiresDefault "access plus 3 month"
        Header unset ETag
        AllowOverride None
        Allow from all
</Directory>

Alias /content "/web/content"
<Directory "/web/content">
	AddHandler cgi-script .php .pl .py .jsp .asp .htm .shtml .sh .cgi
	Options -ExecCGI
	SetEnv force-no-vary

	ExpiresActive On
	ExpiresDefault "access plus 3 month"
	Header unset ETag

	# rewrite rule for an errornous url from myspace - fetch a 1-pixel.gif
	RewriteRule ^(.*)entry/widget/(.*) /images/blank_one_pixel.gif [L]
        AllowOverride None
        Allow from all
</Directory>

Alias /flash "/opt/kaltura/flash"
<Directory "/opt/kaltura/flash">
	AddHandler cgi-script .php .pl .py .jsp .asp .htm .shtml .sh .cgi
	Options -ExecCGI
	SetEnv force-no-vary

	ExpiresActive On
	ExpiresDefault "access plus 3 month"
	Header unset ETag
	FileETag None
        AllowOverride None
        Allow from all
</Directory>

Alias /html5 "/opt/kaltura/html5"
<Directory "/opt/kaltura/html5">
        DirectoryIndex index.php
        Options ExecCGI -Indexes FollowSymLinks Includes
        AllowOverride None
        Order allow,deny
        Allow from all
</Directory>

Alias /javascript "/opt/kaltura/javascript"
<Directory "/opt/kaltura/javascript">
        AddHandler cgi-script .php .pl .py .jsp .asp .htm .shtml .sh .cgi
        Options -ExecCGI

        ExpiresActive On
        ExpiresDefault "access plus 3 month"
        Header unset ETag
        FileETag None
        AllowOverride None
        Allow from all
</Directory>

#Alias /remixamericawiki "/web/kaltura/wiki/mediawiki-1.12"
Alias /wikitest "/web/kaltura/wiki/mediawiki-1.12"
Alias /devwiki-1-12 "/web/kaltura/wiki/mediawiki-1.12"
<Directory "/web/kaltura/wiki/mediawiki-1.12">
        DirectoryIndex index.php
        AllowOverride All
        Allow from all
</Directory>


<Directory "/opt/kaltura/app/alpha/web/blog">
	# redirect blog to corp.kaltura.com
	RewriteEngine on
	RewriteRule ^(.*)$ http://corp.kaltura.com/blog/$1 [R=301,NC]
        AllowOverride None
        Allow from all
</Directory>

<Directory "/opt/kaltura/app/alpha/web/wiki">
        # redirect wiki to corp.kaltura.com
		RewriteEngine on
		RewriteRule ^(.*)$ http://corp.kaltura.com/wiki/$1 [R=301,NC]
        AllowOverride None
        Allow from all
</Directory>
<Directory "/opt/kaltura/app/alpha/web/devwiki">
        # redirect devwiki to corp.kaltura.com
        RewriteEngine on
        RewriteRule ^(.*)$ http://corp.kaltura.com/devwiki/$1 [R=301,NC]
        AllowOverride None
        Allow from all
</Directory>



<Directory "/opt/kaltura/app/alpha/web/openid">
		RewriteEngine on
		RewriteRule pid/(.*)$ /openid/index.php?pid=$1&%{QUERY_STRING} [L]
        AllowOverride None
        Allow from all
</Directory>

</VirtualHost>
MMapFile /opt/kaltura/app/alpha/web/crossdomain.xml
MMapFile /opt/kaltura/app/alpha/web/alive.html
MMapFile /etc/httpd/conf/proxy.map

PassEnv HOSTNAME
Header set X-Me "%{HOSTNAME}e"


